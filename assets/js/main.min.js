$(document).ready(function () {
  //show detail

  btnShowDetail = document.querySelectorAll(".btn-detail");
  btnShowDetail.forEach((element) => {
    element.addEventListener("click", () => {
      detailNumber = element.getAttribute("detail");
      document.querySelector(".detail-show").classList.remove("detail-show");
      detailElement = document.querySelector(`.detail-${detailNumber}`);
      detailElement.classList.add("detail-show");
      $("#exampleModal").modal("show");

      elementHasRefrestAos = detailElement.querySelectorAll(".aos-animate");
      elementHasRefrestAos.forEach((aos) => {
        aos.classList.remove("aos-animate");
      });

      setTimeout(() => {
        AOS.init();
        AOS.refreshHard();
      }, 300);
    });
  });

  itemStacks = [];

  initMyStack = () => {
    console.log("run");
    myStack = document.querySelector(".my-stack");
    itemStacks = myStack.querySelectorAll(".stack-item");
    console.log(itemStacks);
    addZindex(itemStacks);
    addActionButton(itemStacks);
  };

  addActionButton = (itemStacks) => {
    itemStacks.forEach((item, i) => {
      btn = item.querySelector(".active-button");
      btn.addEventListener("click", changePage);
    });
  };

  changePage = (event, index) => {
    activeItem = event.target.closest(".stack-item");
    document.querySelector(".activeStack").classList.remove("activeStack");
    activeItem.classList.add("activeStack");
    arrayFromNodeList = Array.from(itemStacks);
    indexOfItemActive = arrayFromNodeList.indexOf(activeItem);
    console.log(indexOfItemActive);
    scroll(indexOfItemActive);
    resetAos();
  };

  resetAos = () => {
    elementHasRefrestAos = document.querySelectorAll(".aos-animate");
    elementHasRefrestAos.forEach((aos) => {
      aos.classList.remove("aos-animate");
    });

    setTimeout(() => {
      AOS.init();
      AOS.refreshHard();
    }, 900);
  };
  scroll = (indexOfItemActive) => {
    itemStacks.forEach((item, i) => {
      if (i < indexOfItemActive) {
        //to left

        setTimeout(() => {
          item.classList.add("toLeft");
        }, 100);
      } else {
        setTimeout(() => {
          item.classList.remove("toLeft");
        }, 100);
      }
    });
  };

  addZindex = (itemStacks) => {
    itemStacks.forEach((item, i) => {
      item.style.zIndex = `${itemStacks.length - i}`;
    });
  };

  initMyStack();

  ///swwiper slide

  // ------------ TAB 2 ---

  var swiper = new Swiper(".slide-stack-2", {
    grabCursor: true,
    centeredSlides: true,
    loop: true,
    slidesPerView: "auto",
    slidesToShow: 3,
    // slidesPerView: default,
    coverflowEffect: {},
    effect: "coverflow",
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
    navigation: {
      nextEl: ".st-2 .swiper-button-next",
      prevEl: ".st-2 .swiper-button-prev",
    },
    breakpoints: {
      1441: {
        coverflowEffect: {
          rotate: 0,
          stretch: 530,
          depth: 350,
          modifier: 1,
          slideShadows: true,
        },
      },
      1024: {
        coverflowEffect: {
          rotate: 0,
          stretch: 530,
          stretch: 350,
          depth: 300,
          slideShadows: true,
        },
      },

      300: {
        effect: "",
        coverflowEffect: {},
        loop: false,
        slidesToShow: 3,
      },
    },
    // effect: "fade",
  });

  // ------------ TAB 3 ---

  var swiper = new Swiper(".slide-stack-3", {
    navigation: {
      nextEl: ".slide-stack-3 .swiper-button-next",
      prevEl: ".slide-stack-3 .swiper-button-prev",
    },
    // effect: "fade",
  });

  // ------------ TAB 4 ---

  var swiper = new Swiper(".slide-stack-4", {
    navigation: {
      nextEl: ".slide-stack-4 .swiper-button-next",
      prevEl: ".slide-stack-4 .swiper-button-prev",
    },
    // effect: "fade",
  });

  // ------------ TAB 5 ---

  var swiper = new Swiper(".slide-stack-5", {
    navigation: {
      nextEl: ".slide-stack-5 .swiper-button-next",
      prevEl: ".slide-stack-5 .swiper-button-prev",
    },
    // effect: "fade",
  });

  //lăn chuột

  isScroll = false;

  // window.addEventListener(
  //   "wheel",
  //   function (event) {
  //     // Khi sự kiện wheel (lăn chuột) xảy ra
  //     if (!isScroll) {
  //       event.preventDefault();
  //       if (event.deltaY > 0) {
  //         console.log("Lăn chuột xuống");

  //         trickgerScroll("down");
  //       } else if (event.deltaY < 0) {
  //         console.log("Lăn chuột lên");
  //         trickgerScroll("up");
  //       }
  //     }
  //   },
  //   { passive: false }
  // );

  trickgerScroll = (direc) => {
    isScroll = true;
    currentActiveStack = document.querySelector(".activeStack");
    arrayFromNodeList = Array.from(itemStacks);
    currentActiveStackIndex = arrayFromNodeList.indexOf(currentActiveStack);

    if (direc == "down") {
      if (currentActiveStackIndex != arrayFromNodeList.length - 1) {
        targetStack = arrayFromNodeList[currentActiveStackIndex + 1];
        targetStack.querySelector(".active-button").click();
      }
    } else {
      if (currentActiveStackIndex > 0) {
        targetStack = arrayFromNodeList[currentActiveStackIndex - 1];
        targetStack.querySelector(".active-button").click();
      }
    }
    setTimeout(() => {
      isScroll = false;
    }, 500);
  };

  /// Scroll inside

  (function ($) {
    $(window).on("load", function () {
      $(".content").mCustomScrollbar();
    });
  })(jQuery);
});

// write function convert string to number

// write function change background when click on button has id = "haha"
